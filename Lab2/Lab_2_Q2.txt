ORG 00H
LJMP MAIN
ORG 000BH
LJMP NOTEPLAY
ORG 001BH
LJMP DURATION
ORG 0023H
LJMP DATARECEIVED

MAIN: MOV DPTR, #300H
MOV TMOD, #21H ;   T1 is initially for serial reception and then for 0.5 second duration and T0 for notes
SETB PT1
MOV SCON, #50H
MOV IE, #90H ; SERIAL INTERRUPT ENABLED
MOV TH1, #0F4H
SETB TR1
HERE: SJMP HERE


DURATION:
CLR TR1
DJNZ R7, NOTFINISHED
DJNZ R5,LOOPDONE
CJNE R6, #14, NOPROBLEM
CLR TR0
CLR P1.0
MOV TMOD, #21H
MOV TH1, #0F4H
SETB REN     ;SERIAL BAUDRATE AND RECEIVE START
SETB TR1
MOV IE, #90H

SJMP NEXTINFO
NOPROBLEM:
CLR TR0
INC R6; THEESE 2 INCREASE NEEDED TO UPDATE THE FREQUENCY LOCATION
INC R6
MOV A,R4
MOV R5, A
AGAIN:
MOV A, R6
MOVC A, @A+DPTR
MOV TH0, A
MOV A, R6
INC A
MOVC A, @A+DPTR
MOV TL0, A
SETB P1.0
SETB TR0
LOOPDONE:MOV R7, #10
NOTFINISHED: 
	MOV TH1,#HIGH(15536)
	MOV TL1,#LOW(15536)
	SETB TR1
NEXTINFO:RETI
NOTEPLAY:
CLR TR0
MOV A, R6
MOVC A, @A+DPTR
MOV TH0, A
MOV A, R6
INC A
MOVC A, @A+DPTR
MOV TL0, A
CPL P1.0
SETB TR0
RETI
DATARECEIVED:
CLR TR1
MOV A, SBUF
CLR C
CJNE A,#7AH, CARRY
CARRY: JNC MEANINGLES
CJNE A,#070H, TRY
TRY: JC MEANINGLES
ANL A, #0FH
MOV R5, A  ;INITIALIZE
MOV R4,A 
MOV R7, #0BH
MOV R6, #0H
CLR REN; IN ORDER TO STOP SERIAL RECEIVE
MOV TMOD, #11H
SETB TF1
SETB TF0
MOV IE, #9AH
CLR RI
CLR C
SJMP GOTIT
MEANINGLES:
CLR RI
CLR C
MOV TH1, #0F4H 
SETB TR1
GOTIT: RETI
ORG 300H
TABLE: DB 0FCH,44H, 0FCH, 0ACH, 0FDH, 0AH, 0FDH, 34H, 0FDH, 82H, 0FDH, 0C8H, 0FEH, 06H, 0FEH, 22H
END

